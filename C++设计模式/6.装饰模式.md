

- # 代码实现

![](https://github.com/havenow/my-C-plus-plus/blob/master/C%2B%2B设计模式/images/decrorator_demo2.png)  

```c++
#include "stdafx.h"

class Component
{
public:
	Component()
	{
	}
	virtual void Draw() = 0;
	virtual void Resize() = 0;
};

class TextView : public Component
{
public:
	TextView()
	{
	}
	virtual void Draw()
	{
		printf("TextView Draw\n");
	}
	virtual void Resize()
	{
		printf("TextView Resize\n");
	}
};

class Decorator : public Component
{
public:
	Decorator(TextView* com)
		: m_component(com)
	{	
	}
	virtual void Draw()
	{
		m_component->Draw();
	}
	virtual void Resize()
	{
		m_component->Resize();
	}
private://protected:
	TextView* m_component;
};

class BorderTextView : public Decorator
{
public:
	BorderTextView(TextView* com, int borderWidth)
		: Decorator(com)
		, m_width(borderWidth)
	{
	}
	virtual void Draw()
	{
		printf("BorderTextView Draw\n");
		Decorator::Draw();// m_component->Draw();
		Decorator::Resize();//m_component->Resize();
		AddedBehavior_DrawBorder(m_width);
	}
private:
	int m_width;
	void AddedBehavior_DrawBorder(int nWidth)
	{
		printf("AddedBehavior_DrawBorder %d\n", nWidth);
	}
};

void Process()
{
	TextView* textView = new TextView();
	BorderTextView* borderTextView = new BorderTextView(textView, 6);
	borderTextView->Draw();

	delete textView;
	delete borderTextView;
}


int _tmain(int argc, _TCHAR* argv[])
{
	Process();
	return 0;
}


```

![](https://github.com/havenow/my-C-plus-plus/blob/master/C%2B%2B设计模式/images/decorator_demo.png)  

```c++
#include "stdafx.h"

//业务操作
class Stream
{
public:
	virtual char Read(int number) = 0;
	virtual void Seek(int position) = 0;
	virtual void Write(char data) = 0;

	virtual ~Stream(){}
};

//主体类
class FileStream : public Stream
{
public:
	virtual char Read(int number)
	{
		printf("FileStream Read\n");
		return 0;
	}
	virtual void Seek(int position)
	{
		printf("FileStream Seek\n");
	}
	virtual void Write(char data)
	{
		printf("FileStream Write\n");
	}

};

class NetworkStream :public Stream
{
public:
	virtual char Read(int number)
	{
		printf("NetworkStream Read\n");
		return 0;
	}
	virtual void Seek(int position)
	{
		printf("NetworkStream Seek\n");
	}
	virtual void Write(char data)
	{
		printf("NetworkStream Write\n");
	}

};

class MemoryStream :public Stream
{
public:
	virtual char Read(int number)
	{
		printf("MemoryStream Read\n");
	}
	virtual void Seek(int position)
	{
		printf("MemoryStream Seek\n");
	}
	virtual void Write(char data)
	{
		printf("MemoryStream Write\n");
	}

};

//扩展操作

class DecoratorStream: public Stream
{
protected:
	Stream* stream;//...

	DecoratorStream(Stream * stm) :stream(stm)
	{

	}
};

class CryptoStream : public DecoratorStream
{
public:
	CryptoStream(Stream* stm) :DecoratorStream(stm)
	{

	}

	virtual char Read(int number)
	{
		printf("CryptoStream\n");
		//额外的加密操作...
		stream->Read(number);//读文件流
		return 0;
	}
	virtual void Seek(int position)
	{
		printf("CryptoStream\n");
		//额外的加密操作...
		stream->Seek(position);//定位文件流
		//额外的加密操作...
	}
	virtual void Write(char data)
	{
		printf("CryptoStream\n");
		//额外的加密操作...
		stream->Write(data);//写文件流
		//额外的加密操作...
	}
};



class BufferedStream : public DecoratorStream
{
	Stream* stream;//...

public:
	BufferedStream(Stream* stm) : DecoratorStream(stm)
	{

	}
	
	virtual char Read(int number)
	{
		//额外的加密操作...
		stream->Read(number);//读文件流
		return 0;
	}
	virtual void Seek(int position)
	{
		//额外的加密操作...
		stream->Seek(position);//定位文件流
		//额外的加密操作...
	}
	virtual void Write(char data)
	{
		//额外的加密操作...
		stream->Write(data);//写文件流
		//额外的加密操作...
	}
};

class NetStream : public DecoratorStream
{
	Stream* stream;//...

public:
	NetStream(Stream* stm) : DecoratorStream(stm)
	{

	}

	virtual char Read(int number)
	{
		//额外的加密操作...
		stream->Read(number);//读文件流
		return 0;
	}
	virtual void Seek(int position)
	{
		//额外的加密操作...
		stream->Seek(position);//定位文件流
		//额外的加密操作...
	}
	virtual void Write(char data)
	{
		//额外的加密操作...
		stream->Write(data);//写文件流
		//额外的加密操作...
	}
};

void Process()
{
	//运行时装配
	FileStream* s1 = new FileStream();

	CryptoStream* s2 = new CryptoStream(s1);
	s2->Read(0);
	s2->Seek(0);
	s2->Write('a');

	BufferedStream* s3 = new BufferedStream(s1);

	NetStream* s4 = new NetStream(s1);
}


int _tmain(int argc, _TCHAR* argv[])
{
	Process();
	return 0;
}


```
